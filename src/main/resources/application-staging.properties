spring.config.activate.on-profile=staging

# ???????????????????????????????????????????????????????????????????????????
# MEMORY OPTIMIZATION FOR 512MB RAM LIMIT
# ???????????????????????????????????????????????????????????????????????????
spring.main.lazy-initialization=true
spring.jmx.enabled=false
spring.main.banner-mode=off

# ???????????????????????????????????????????????????????????????????????????
# DATABASE CONFIGURATION - Render PostgreSQL (staging)
# ???????????????????????????????????????????????????????????????????????????
spring.datasource.url=${DATABASE_URL}
spring.datasource.username=${DATABASE_USERNAME}
spring.datasource.password=${DATABASE_PASSWORD}
spring.datasource.driver-class-name=org.postgresql.Driver

# SSL - required for Render/cloud PostgreSQL
spring.datasource.hikari.data-source-properties.sslmode=require
spring.datasource.hikari.data-source-properties.ssl=true

# HikariCP - optimised for 512MB
spring.datasource.hikari.maximum-pool-size=5
spring.datasource.hikari.minimum-idle=2
spring.datasource.hikari.connection-timeout=20000
spring.datasource.hikari.idle-timeout=300000
spring.datasource.hikari.max-lifetime=600000
spring.datasource.hikari.leak-detection-threshold=60000
spring.datasource.hikari.connection-test-query=SELECT 1

# ???????????????????????????????????????????????????????????????????????????
# JPA / HIBERNATE
# ???????????????????????????????????????????????????????????????????????????
spring.jpa.hibernate.ddl-auto=none
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=false
spring.jpa.open-in-view=false
spring.jpa.properties.hibernate.jdbc.batch_size=10
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.generate_statistics=false
spring.jpa.properties.hibernate.default_batch_fetch_size=5

# ???????????????????????????????????????????????????????????????????????????
# FLYWAY
# ???????????????????????????????????????????????????????????????????????????
spring.flyway.enabled=true
spring.flyway.baseline-on-migrate=true
spring.flyway.baseline-version=0
spring.flyway.locations=classpath:db/migration
spring.flyway.validate-on-migrate=false
spring.flyway.out-of-order=false

# ???????????????????????????????????????????????????????????????????????????
# JWT
# ???????????????????????????????????????????????????????????????????????????
app.jwt.secret=${JWT_SECRET}
app.jwt.expiration-ms=86400000

# ???????????????????????????????????????????????????????????????????????????
# OAUTH
# ???????????????????????????????????????????????????????????????????????????
oauth.google.client-id=${GOOGLE_CLIENT_ID}
oauth.apple.bundle-id=${APPLE_BUNDLE_ID}

# ???????????????????????????????????????????????????????????????????????????
# GMAIL
# ???????????????????????????????????????????????????????????????????????????
gmail.client-id=${GMAIL_CLIENT_ID:}
gmail.client-secret=${GMAIL_CLIENT_SECRET:}
gmail.refresh-token=${GMAIL_REFRESH_TOKEN:}
gmail.from-email=${GMAIL_FROM_EMAIL:gethyperindia@gmail.com}

# ???????????????????????????????????????????????????????????????????????????
# CLOUDINARY
# ???????????????????????????????????????????????????????????????????????????
cloudinary.cloud-name=${CLOUDINARY_CLOUD_NAME:}
cloudinary.api-key=${CLOUDINARY_API_KEY:}
cloudinary.api-secret=${CLOUDINARY_API_SECRET:}

# ???????????????????????????????????????????????????????????????????????????
# RAZORPAY
# ???????????????????????????????????????????????????????????????????????????
razorpay.key-id=${RAZORPAY_KEY_ID}
razorpay.key-secret=${RAZORPAY_KEY_SECRET}
razorpay.environment=${RAZORPAY_ENVIRONMENT:test}
razorpay.webhook-secret=${RAZORPAY_WEBHOOK_SECRET}

# ???????????????????????????????????????????????????????????????????????????
# PRICING
# ???????????????????????????????????????????????????????????????????????????
pricing.tax-rate=${PRICING_TAX_RATE:18.0}
pricing.convenience-fee-rate=${PRICING_CONVENIENCE_FEE_RATE:2.5}
pricing.convenience-fee-fixed=${PRICING_CONVENIENCE_FEE_FIXED:10.0}
pricing.platform-fee-rate=${PRICING_PLATFORM_FEE_RATE:2.0}
pricing.online-payment-percent=${PRICING_ONLINE_PAYMENT_PERCENT:20}

# ???????????????????????????????????????????????????????????????????????????
# BOOKING
# ???????????????????????????????????????????????????????????????????????????
booking.lock-duration-minutes=${BOOKING_LOCK_DURATION_MINUTES:15}

# ???????????????????????????????????????????????????????????????????????????
# REFUND
# ???????????????????????????????????????????????????????????????????????????
refund.enabled=${REFUND_ENABLED:true}
refund.min-minutes-for-cancellation=${REFUND_MIN_MINUTES:0}
refund.allow-past-cancellation=${REFUND_ALLOW_PAST:false}
refund.rules[0].min-minutes-before=720
refund.rules[0].refund-percent=100
refund.rules[1].min-minutes-before=0
refund.rules[1].refund-percent=0

# ???????????????????????????????????????????????????????????????????????????
# PLATFORM
# ???????????????????????????????????????????????????????????????????????????
platform.advance-percentage=20

# ???????????????????????????????????????????????????????????????????????????
# EXPO PUSH NOTIFICATIONS
# ???????????????????????????????????????????????????????????????????????????
expo.push.url=https://exp.host/--/api/v2/push/send
expo.push.enabled=true

# ???????????????????????????????????????????????????????????????????????????
# INVOICE GENERATOR
# ???????????????????????????????????????????????????????????????????????????
invoice.generator.url=${INVOICE_GENERATOR_URL:http://localhost:8081/invoice}

# ???????????????????????????????????????????????????????????????????????????
# ASYNC - must be true so @Async on InvoiceEventListener uses the managed
# thread pool instead of the default SimpleAsyncTaskExecutor
# ???????????????????????????????????????????????????????????????????????????
async.enabled=true
spring.task.execution.pool.core-size=2
spring.task.execution.pool.max-size=4
spring.task.execution.pool.queue-capacity=50
spring.task.execution.thread-name-prefix=staging-async-

# ???????????????????????????????????????????????????????????????????????????
# SMS - disabled in staging
# ???????????????????????????????????????????????????????????????????????????
sms.enabled=false

# ???????????????????????????????????????????????????????????????????????????
# API DOCS - disabled in staging
# ???????????????????????????????????????????????????????????????????????????
springdoc.api-docs.enabled=false
springdoc.swagger-ui.enabled=false

# ???????????????????????????????????????????????????????????????????????????
# LOGGING
# ???????????????????????????????????????????????????????????????????????????
logging.level.root=WARN
logging.level.com.hitendra=INFO
logging.level.org.flywaydb=INFO
logging.level.org.springframework.web=WARN
logging.level.org.hibernate=WARN
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} - %msg%n

# ???????????????????????????????????????????????????????????????????????????
# SERVER
# ???????????????????????????????????????????????????????????????????????????
server.port=${PORT:8080}
server.shutdown=graceful
spring.lifecycle.timeout-per-shutdown-phase=20s
server.tomcat.threads.max=200
server.tomcat.threads.min-spare=10
server.tomcat.connection-timeout=20000
server.tomcat.accept-count=100
server.compression.enabled=true
server.compression.mime-types=application/json,text/html,text/plain

# File upload
spring.servlet.multipart.max-file-size=10MB
spring.servlet.multipart.max-request-size=10MB

# ???????????????????????????????????????????????????????????????????????????
# ACTUATOR - health checks only
# ???????????????????????????????????????????????????????????????????????????
management.endpoints.web.exposure.include=health
management.endpoint.health.show-details=never
management.endpoint.health.probes.enabled=true
